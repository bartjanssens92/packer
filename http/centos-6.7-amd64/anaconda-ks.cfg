# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
url --url=http://pulp2.internal.inuits.eu/pulp/repos/pub/centos/6/os/x86_64/
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --mtu=1500 --bootproto static --ip 10.0.64.12 --netmask 255.255.224.0 --gateway 10.0.64.3 --noipv6 --nameserver 10.0.64.1 --hostname pulp
rootpw  --iscrypted $1$Pltfa5Hk$HZNHxXCndn.szG2bEtzHt1
# System services
services --disabled="ip6tables,netfs,haldaemon,messagebus,abrtd,abrt-ccpp,abrt-oops"
# Reboot after installation
reboot
firewall --port=22:tcp
authconfig --useshadow --enablemd5
selinux --permissive
timezone Europe/Brussels
bootloader --location=mbr --driveorder=vda --append="console=ttyS0 crashkernel=auto"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
#clearpart --all --initlabel

#part /boot --fstype=ext3 --size=100
#part pv.253002 --grow --size=9000
#volgroup vg_pulp --pesize=32768 pv.253002
#logvol / --fstype=ext4 --name=lv_root --vgname=vg_pulp --grow --size=2048
#logvol swap --name=lv_swap --vgname=vg_pulp --size=2048
#logvol /var --fstype=ext4 --name=lv_var --vgname=vg_pulp --size=4096

repo --name="CentOS"  --baseurl=http://pulp2.internal.inuits.eu/pulp/repos/pub/centos/6/os/x86_64/ --cost=100
repo --name="epel"  --baseurl=http://pulp2.internal.inuits.eu/pulp/repos/pub/epel/6/x86_64/ --cost=1000
repo --name="updates"  --baseurl=http://pulp2.internal.inuits.eu/pulp/repos/pub/centos/6/updates/x86_64/ --cost=1000

%packages
@Base
@Core
@core
bzip2
kernel-devel
make
openssl-devel
readline-devel
ruby
ruby-augeas
ruby-devel
ruby-shadow
rubygems
sqlite-devel
zlib-devel
-ipw2100-firmware
-ipw2200-firmware
-ivtv-firmware
-networkmanager
-plymouth
-plymouth-core-libs
-plymouth-scripts
-redhat-logos
-system-config-network-tui

%end

%post
(
	# enable serial console
	sed -i 's/LABEL=\//& console=ttyS0/' /boot/grub/grub.conf
	echo 'S0:12345:respawn:/sbin/agetty ttyS0 115200' >> /etc/inittab
	echo "ttyS0" >> /etc/securetty
) 1>/root/post_install.log 2>&1

# install inuits repo
cat > /etc/yum.repos.d/inuits.repo <<EOF
[inuits]
name=inuits internal CentOS 6.x repo
baseurl=http://pulp2.internal.inuits.eu/pulp/repos/pub/inuits/6/\$basearch
enabled=1
gpgcheck=0
EOF

# set up domain and search strings in resolv.conf
cat >> /etc/resolv.conf <<EOF
domain inuits.eu
search internal.inuits.eu inuits.eu
EOF


# add datacenter name
cat > /etc/datacenter <<EOF
dc3
EOF



# install puppet
yum install -q -y puppet

# puppet config
cat > /etc/puppet/puppet.conf <<EOF
[main]
logdir=/var/log/puppet
vardir=/var/lib/puppet
ssldir=/var/lib/puppet/ssl
rundir=/var/run/puppet
factpath=$vardir/lib/facter
pluginsync=true
templatedir=$confdir/templates

[master]
# These are needed when the puppetmaster is run by passenger
# and can safely be removed if webrick is used.
# ssl_client_header = SSL_CLIENT_S_DN
# ssl_client_verify_header = SSL_CLIENT_VERIFY

[agent]
environment=production
report=true
EOF

# run puppet agent for reg
puppet agent --test

# work around erb syntax error
%end
